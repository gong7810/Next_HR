<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.seoulit.insa.salary.mapper.SeverancePayMapper">

    <resultMap type="kr.co.seoulit.insa.salary.to.SeverancePayTO" id="severancePayResult">
        <result property="applyDate" column="APPLY_DATE" />
        <result property="severanceType" column="SEVERANCE_TYPE" />
        <result property="empCode" column="EMP_CODE" />
        <result property="empName" column="EMP_NAME" />
        <result property="workDays" column="WORK_DAYS" />
        <result property="severancePay" column="SEVERANCE_PAY" />
        <result property="severanceDeduction" column="SEVERANCE_DEDUCTION" />
        <result property="realSeverancePay" column="REAL_SEVERANCE_PAY" />
        <result property="retireDate" column="RETIRE_DATE" />
        <result property="hireDate" column="HIRE_DATE" />
    </resultMap>


    <select id="findSeverancePayList" parameterType="map" resultMap="severancePayResult">
        SELECT SP.*, EB.EMP_NAME, EB.HIRE_DATE
        FROM SEVERANCE_PAY SP, EMPLOYEE_BASIC EB
        WHERE SP.EMP_CODE = EB.EMP_CODE
          AND SP.APPLY_DATE BETWEEN TO_DATE(#{firstDay},'YYYY-MM-DD') and TO_DATE(#{today},'YYYY-MM-DD')
    </select>


    <parameterMap type="kr.co.seoulit.insa.salary.to.SeverancePayTO" id="registSeverancePayParameter" >
        <parameter property="applyDate" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
        <parameter property="retireDate" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
        <parameter property="empCode" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN" />
        <parameter property="workDays" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
        <parameter property="hireDate" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
        <parameter property="severanceType" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
        <parameter property="firstDay" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
        <parameter property="today" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
        <parameter property="result" jdbcType="CURSOR" javaType="java.sql.ResultSet" mode="OUT" resultMap="severancePayResult"/>
        <parameter property="errorCode" jdbcType="VARCHAR" javaType="java.lang.String" mode="OUT" />
        <parameter property="errorMsg" jdbcType="VARCHAR" javaType="java.lang.String" mode="OUT" />
    </parameterMap>

    <select id="registSeverancePay" parameterMap="registSeverancePayParameter">
		<![CDATA[
        {call P_CREATE_SEVERANCE_PAY(?,?,?,?,?,?,?,?,?,?,?)}
        ]]>
	</select>

    <delete id="deleteSeverancePay" parameterType="kr.co.seoulit.insa.salary.to.SeverancePayTO">
	<![CDATA[
        DELETE FROM SEVERANCE_PAY
        WHERE EMP_CODE = #{empCode}
        ]]>
	</delete>

</mapper>